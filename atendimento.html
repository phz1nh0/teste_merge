<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atendimento - IA SISTEM</title>
    <link href="css/styles.css" rel="stylesheet">
</head>

<body>
    <!-- HEADER -->
    <header class="header">
        <div class="logo-section">
            <button class="icon-btn" id="menuToggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <div class="logo">
                <img src="img/ia-system.png" alt="Logo IA Sistem">
            </div>
            <div class="brand">
                <h2>IA SISTEM</h2>
                <p>Sistema de Gerenciamento</p>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Buscar por cliente, OS, produto...">
            <button class="search-btn">üîç</button>
        </div>

        <div class="header-actions">
            <button class="icon-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <span class="notification-badge" id="notificationCount">0</span>
            </button>
            <button class="icon-btn">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <circle cx="12" cy="10" r="3"></circle>
                    <path d="M6.168 18.849A4 4 0 0 1 10 16h4a4 4 0 0 1 3.834 2.855"></path>
                </svg>
            </button>
            <button class="icon-btn" data-logout title="Sair do Sistema">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
            </button>
        </div>
    </header>

    <!-- LAYOUT PRINCIPAL -->
    <div class="main-layout">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
              <div class="sidebar-section">
                <div class="sidebar-title">M√≥dulos</div>
                <ul class="sidebar-menu">
                    <li><a href="atendimento.html" class="active">Dashboard</a></li>
                    <li><a href="atendimento.html">Atendimento</a></li>
                    <li><a href="clientes.html">Cliente</a></li>
                    <li><a href="atendimento.html">Financeiro</a></li>
                    <li><a href="estoque.html">Estoque</a></li>
                    <li><a href="os.html">O.S</a></li>
                    <li><a href="atendimento.html">Configura√ß√£o</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Ajuda</div>
                <ul class="sidebar-menu">
                    <li><a href="atendimento.html">Suporte</a></li>
                    <li><a href="atendimento.html">Tutorial</a></li>
                </ul>
            </div>
        </aside>

        <!-- CONTE√öDO -->
        <main class="content">
            <div class="page-header">
                <h1>Dashboard - Atendimento</h1>
                <div class="breadcrumb">Dashboard / Atendimento</div>
            </div>

            <!-- CARDS DE ESTAT√çSTICAS -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        üìã
                    </div>
                    <div class="stat-info">
                        <h3 id="totalOS">0</h3>
                        <p>Total de O.S</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon green">
                        üë•
                    </div>
                    <div class="stat-info">
                        <h3 id="totalClientes">0</h3>
                        <p>Clientes</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon yellow">
                        üì¶
                    </div>
                    <div class="stat-info">
                        <h3 id="totalProdutos">0</h3>
                        <p>Produtos</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon red">
                        ‚ö†Ô∏è
                    </div>
                    <div class="stat-info">
                        <h3 id="alertas">0</h3>
                        <p>Alertas</p>
                    </div>
                </div>
            </div>

            <!-- A√á√ïES R√ÅPIDAS -->
            <div class="quick-actions">
                <div class="action-card" onclick="abrirNovaOS()">
                    <div class="action-card-icon">üìù</div>
                    <h3>Nova OS</h3>
                    <p>Criar nova ordem de servi√ßo</p>
                </div>

                <div class="action-card" onclick="abrirNovoCliente()">
                    <div class="action-card-icon">üë§</div>
                    <h3>Novo Cliente</h3>
                    <p>Cadastrar novo cliente</p>
                </div>

                <div class="action-card" onclick="consultarEstoque()">
                    <div class="action-card-icon">üì¶</div>
                    <h3>Consultar Estoque</h3>
                    <p>Verificar disponibilidade de pe√ßas</p>
                </div>

                <div class="action-card" onclick="buscarCliente()">
                    <div class="action-card-icon">üîç</div>
                    <h3>Buscar Cliente</h3>
                    <p>Pesquisar clientes cadastrados</p>
                </div>
            </div>

            <!-- ALERTAS -->
            <div class="alerts-section">
                <h2>Alertas e Notifica√ß√µes</h2>
                <div id="alertasContainer">
                    <!-- Alertas ser√£o inseridos via JavaScript -->
                </div>
            </div>

            <!-- TABELA DE OS RECENTES -->
            <div class="os-table-section">
                <div class="section-header">
                    <h2>Ordens de Servi√ßo Recentes</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="todas">Todas</button>
                        <button class="filter-btn" data-filter="aguardando">Aguardando</button>
                        <button class="filter-btn" data-filter="em_reparo">Em Reparo</button>
                        <button class="filter-btn" data-filter="pronto">Prontas</button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="os-table" id="osTable">
                    <thead>
                        <tr>
                            <th>OS</th>
                            <th>Cliente</th>
                            <th>Aparelho</th>
                            <th>Problema</th>
                            <th>Status</th>
                            <th>Data</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                        <tbody id="osTableBody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                    </tbody>
                </table>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL NOVA OS -->
    <div class="modal" id="modalNovaOS">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nova Ordem de Servi√ßo</h2>
                <button class="close-modal" onclick="fecharModal()">√ó</button>
            </div>

            <form id="formNovaOS">
                <div class="form-group">
                    <label for="clienteOS">Cliente *</label>
                    <select id="clienteOS" name="cliente" required>
                        <option value="">Selecione o cliente...</option>
                        <!-- Op√ß√µes ser√£o preenchidas via JavaScript -->
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoAparelho">Tipo de Aparelho *</label>
                        <select id="tipoAparelho" name="tipoAparelho" required>
                            <option value="">Selecione...</option>
                            <option value="smartphone">Smartphone</option>
                            <option value="tablet">Tablet</option>
                            <option value="notebook">Notebook</option>
                            <option value="desktop">Desktop</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                <div class="form-group">
                        <label for="marcaModelo">Marca/Modelo *</label>
                        <input type="text" id="marcaModelo" name="marcaModelo" placeholder="Ex: iPhone 12 Pro" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="problemaRelatado">Problema Relatado *</label>
                    <textarea id="problemaRelatado" name="problemaRelatado" rows="4" placeholder="Descreva o problema reportado pelo cliente" required></textarea>
                </div>

                <div class="form-row">
                <div class="form-group">
                        <label for="prazoEstimado">Prazo Estimado (dias) *</label>
                        <input type="number" id="prazoEstimado" name="prazoEstimado" value="3" min="1" required>
                </div>
                <div class="form-group">
                        <label for="prioridade">Prioridade</label>
                        <select id="prioridade" name="prioridade">
                            <option value="normal">Normal</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Criar OS</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL NOVO CLIENTE -->
    <div class="modal" id="modalNovoCliente">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Cliente</h2>
                <button class="close-modal" onclick="fecharModal()">√ó</button>
            </div>

            <form id="formNovoCliente">
                <div class="form-group">
                    <label for="nomeCliente">Nome Completo *</label>
                    <input type="text" id="nomeCliente" name="nome" placeholder="Nome do cliente" required>
                </div>

                <div class="form-row">
                <div class="form-group">
                        <label for="cpfCnpjCliente">CPF/CNPJ *</label>
                        <input type="text" id="cpfCnpjCliente" name="cpfCnpj" placeholder="000.000.000-00" required>
                </div>
                <div class="form-group">
                        <label for="telefoneCliente">Telefone *</label>
                        <input type="tel" id="telefoneCliente" name="telefone" placeholder="(00) 00000-0000" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="emailCliente">E-mail</label>
                    <input type="email" id="emailCliente" name="email" placeholder="cliente@email.com">
                </div>

                <div class="form-group">
                    <label for="enderecoCliente">Endere√ßo</label>
                    <input type="text" id="enderecoCliente" name="endereco" placeholder="Rua, n√∫mero, bairro">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Cadastrar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL BUSCAR CLIENTE -->
    <div class="modal" id="modalBuscarCliente">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Buscar Cliente</h2>
                <button class="close-modal" onclick="fecharModal()">√ó</button>
            </div>

            <div class="form-group">
                <input type="text" id="buscaCliente" placeholder="Digite nome, CPF ou telefone do cliente...">
            </div>

            <div id="resultadosBusca" class="resultados-busca">
                <!-- Resultados ser√£o inseridos via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/clientes.js"></script>
    <script src="js/estoque.js"></script>
    <script>
        // ========================================
        // SCRIPT DA P√ÅGINA DE ATENDIMENTO
        // ========================================

        // Chave para armazenar OS no localStorage
        const CHAVE_OS = 'ia_sistem_os';

        // Array que mant√©m as OS em mem√≥ria
        let osEmMemoria = [];

        // Elementos do DOM
        const searchInput = document.getElementById('searchInput');
        const osTableBody = document.getElementById('osTableBody');
        const alertasContainer = document.getElementById('alertasContainer');
        const totalOS = document.getElementById('totalOS');
        const totalClientes = document.getElementById('totalClientes');
        const totalProdutos = document.getElementById('totalProdutos');
        const alertas = document.getElementById('alertas');
        const notificationCount = document.getElementById('notificationCount');

        // ============================
        // FUN√á√ïES DE DADOS
        // ============================

        /**
         * Carrega todas as OS do localStorage
         */
        function carregarOS() {
            const os = recuperarDados(CHAVE_OS);
            osEmMemoria = os || [];
            return osEmMemoria;
        }

        /**
         * Salva todas as OS no localStorage
         */
        function salvarOS() {
            return salvarDados(CHAVE_OS, osEmMemoria);
        }

        /**
         * Adiciona uma nova OS
         */
        function adicionarOS(os) {
            const proximoNumero = gerarProximoNumeroOS();
            os.numeroOS = proximoNumero;
            os.id = gerarId();
            os.dataCriacao = new Date().toISOString();
            os.dataAtualizacao = new Date().toISOString();
            os.status = os.status || 'aguardando';
            
            osEmMemoria.push(os);
            salvarOS();
            
            console.log('‚úÖ OS adicionada:', os.numeroOS);
            return os;
        }

        /**
         * Gera pr√≥ximo n√∫mero de OS
         */
        function gerarProximoNumeroOS() {
            const numerosExistentes = osEmMemoria.map(os => {
                const numero = os.numeroOS.replace('#', '').replace('OS', '');
                return parseInt(numero) || 0;
            });
            
            const proximoNumero = Math.max(...numerosExistentes, 0) + 1;
            return `#OS${proximoNumero.toString().padStart(4, '0')}`;
        }

        /**
         * Busca OS por termo
         */
        function buscarOS(termo) {
            if (!termo || termo.trim() === '') {
                return osEmMemoria.slice(0, 10); // Mostra apenas as 10 mais recentes
            }
            
            const termoLower = termo.toLowerCase();
            
            return osEmMemoria.filter(os => {
                return (
                    os.numeroOS.toLowerCase().includes(termoLower) ||
                    os.cliente.toLowerCase().includes(termoLower) ||
                    os.marcaModelo.toLowerCase().includes(termoLower) ||
                    os.problemaRelatado.toLowerCase().includes(termoLower)
                );
            });
        }

        // ============================
        // FUN√á√ïES DE INTERFACE
        // ============================

        /**
         * Atualiza as estat√≠sticas na tela
         */
        function atualizarEstatisticas() {
            const totalOSCount = osEmMemoria.length;
            const totalClientesCount = clientesEmMemoria.length;
            const totalProdutosCount = produtosEmMemoria.length;
            
            // Calcula alertas (OS atrasadas + estoque baixo)
            const hoje = new Date();
            const osAtrasadas = osEmMemoria.filter(os => {
                if (os.status === 'entregue' || os.status === 'cancelado') return false;
                const dataCriacao = new Date(os.dataCriacao);
                const prazoLimite = new Date(dataCriacao);
                prazoLimite.setDate(prazoLimite.getDate() + (os.prazoEstimado || 3));
                return hoje > prazoLimite;
            }).length;

            const estoqueBaixo = produtosEmMemoria.filter(p => {
                const status = calcularStatusEstoque(p.quantidade, p.estoqueMinimo);
                return status === 'critico' || status === 'baixo';
            }).length;

            const totalAlertas = osAtrasadas + estoqueBaixo;

            totalOS.textContent = totalOSCount;
            totalClientes.textContent = totalClientesCount;
            totalProdutos.textContent = totalProdutosCount;
            alertas.textContent = totalAlertas;
            notificationCount.textContent = totalAlertas;
        }

        /**
         * Renderiza a tabela de OS
         */
        function renderizarTabelaOS() {
            const osRecentes = osEmMemoria
                .sort((a, b) => new Date(b.dataCriacao) - new Date(a.dataCriacao))
                .slice(0, 10);

            osTableBody.innerHTML = '';

            if (osRecentes.length === 0) {
                osTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray-medium);">
                            <div style="font-size: 48px; margin-bottom: 20px;">üìã</div>
                            <div>Nenhuma ordem de servi√ßo encontrada</div>
                            <div style="font-size: 14px; margin-top: 10px;">Crie sua primeira O.S!</div>
                        </td>
                    </tr>
                `;
                return;
            }

            osRecentes.forEach(os => {
                const row = document.createElement('tr');
                const dataCriacao = new Date(os.dataCriacao);
                const prazoLimite = new Date(dataCriacao);
                prazoLimite.setDate(prazoLimite.getDate() + (os.prazoEstimado || 3));
                const hoje = new Date();
                const atrasada = hoje > prazoLimite && os.status !== 'entregue' && os.status !== 'cancelado';
                
                row.innerHTML = `
                    <td><strong>${os.numeroOS}</strong></td>
                    <td>${os.cliente}</td>
                    <td>
                        <div class="aparelho-info">
                            <div class="aparelho-icon">üì±</div>
                            <span>${os.marcaModelo}</span>
                        </div>
                    </td>
                    <td class="problema-cell">${os.problemaRelatado.substring(0, 50)}${os.problemaRelatado.length > 50 ? '...' : ''}</td>
                    <td><span class="status-badge ${os.status}">${getStatusText(os.status)}</span></td>
                    <td>${formatarData(os.dataCriacao)}</td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn-small btn-view" onclick="visualizarOS('${os.id}')" title="Visualizar">
                                üëÅÔ∏è
                            </button>
                            <button class="action-btn-small btn-edit" onclick="editarOS('${os.id}')" title="Editar">
                                ‚úèÔ∏è
                            </button>
                        </div>
                    </td>
                `;
                osTableBody.appendChild(row);
            });
        }

        /**
         * Renderiza os alertas
         */
        function renderizarAlertas() {
            const hoje = new Date();
            const alertasList = [];

            // OS atrasadas
            const osAtrasadas = osEmMemoria.filter(os => {
                if (os.status === 'entregue' || os.status === 'cancelado') return false;
                const dataCriacao = new Date(os.dataCriacao);
                const prazoLimite = new Date(dataCriacao);
                prazoLimite.setDate(prazoLimite.getDate() + (os.prazoEstimado || 3));
                return hoje > prazoLimite;
            });

            osAtrasadas.forEach(os => {
                alertasList.push({
                    tipo: 'urgent',
                    titulo: `${os.numeroOS} - Cliente aguardando retorno`,
                    descricao: `${os.cliente} - Prazo vencido`,
                    acao: () => visualizarOS(os.id)
                });
            });

            // Estoque baixo
            const estoqueBaixo = produtosEmMemoria.filter(p => {
                const status = calcularStatusEstoque(p.quantidade, p.estoqueMinimo);
                return status === 'critico';
            });

            estoqueBaixo.forEach(produto => {
                alertasList.push({
                    tipo: 'critical',
                    titulo: `${produto.nome} - Estoque Cr√≠tico`,
                    descricao: `Apenas ${produto.quantidade} unidades dispon√≠veis`,
                    acao: () => window.location.href = 'estoque.html'
            });
        });

            // OS prontas para retirada
            const osProntas = osEmMemoria.filter(os => os.status === 'pronto');
            if (osProntas.length > 0) {
                alertasList.push({
                    tipo: 'info',
                    titulo: `${osProntas.length} aparelhos prontos para retirada`,
                    descricao: 'Clientes aguardando contato',
                    acao: () => window.location.href = 'os.html'
                });
            }

            alertasContainer.innerHTML = '';

            if (alertasList.length === 0) {
                alertasContainer.innerHTML = `
                    <div class="alert-item info">
                        <div class="alert-content">
                            <strong>Nenhum alerta no momento</strong>
                            <span>Tudo funcionando normalmente</span>
                        </div>
                    </div>
                `;
                return;
            }

            alertasList.forEach(alerta => {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert-item ${alerta.tipo}`;
                alertDiv.innerHTML = `
                    <div class="alert-content">
                        <strong>${alerta.titulo}</strong>
                        <span>${alerta.descricao}</span>
                    </div>
                    <button class="alert-action" onclick="(${alerta.acao.toString()})()">Ver Detalhes</button>
                `;
                alertasContainer.appendChild(alertDiv);
            });
        }

        /**
         * Retorna texto do status
         */
        function getStatusText(status) {
            const statusMap = {
                'aguardando': 'Aguardando',
                'em_reparo': 'Em Reparo',
                'pronto': 'Pronto',
                'entregue': 'Entregue',
                'cancelado': 'Cancelado'
            };
            return statusMap[status] || status;
        }

        // ============================
        // FUN√á√ïES DE A√á√ïES R√ÅPIDAS
        // ============================

        /**
         * Abre modal para nova OS
         */
        function abrirNovaOS() {
            const modal = document.getElementById('modalNovaOS');
            const selectCliente = document.getElementById('clienteOS');
            
            // Carrega clientes no select
            selectCliente.innerHTML = '<option value="">Selecione o cliente...</option>';
            clientesEmMemoria.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.nome;
                option.textContent = cliente.nome;
                selectCliente.appendChild(option);
            });
            
            modal.classList.add('active');
        }

        /**
         * Abre modal para novo cliente
         */
        function abrirNovoCliente() {
            const modal = document.getElementById('modalNovoCliente');
            modal.classList.add('active');
        }

        /**
         * Redireciona para p√°gina de estoque
         */
        function consultarEstoque() {
            window.location.href = 'estoque.html';
        }

        /**
         * Abre modal para buscar cliente
         */
        function buscarCliente() {
            const modal = document.getElementById('modalBuscarCliente');
            modal.classList.add('active');
        }

        /**
         * Visualiza OS
         */
        function visualizarOS(id) {
            window.location.href = `os.html#view=${id}`;
        }

        /**
         * Edita OS
         */
        function editarOS(id) {
            window.location.href = `os.html#edit=${id}`;
        }

        /**
         * Fecha todos os modais
         */
        function fecharModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
        }

        // ============================
        // EVENTOS
        // ============================

        // Evento de busca
        searchInput.addEventListener('input', function(e) {
            const termo = e.target.value.trim();
            if (termo) {
                const resultados = buscarOS(termo);
                renderizarTabelaOS();
            } else {
                renderizarTabelaOS();
            }
        });

        // Evento do formul√°rio de nova OS
        document.getElementById('formNovaOS').addEventListener('submit', function(e) {
                e.preventDefault();

            const formData = new FormData(this);
            const dados = Object.fromEntries(formData.entries());

            if (adicionarOS(dados)) {
                alert('O.S criada com sucesso!');
                fecharModal();
                renderizarTabelaOS();
                atualizarEstatisticas();
                this.reset();
            } else {
                alert('Erro ao criar O.S. Tente novamente.');
            }
        });

        // Evento do formul√°rio de novo cliente
        document.getElementById('formNovoCliente').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const dados = Object.fromEntries(formData.entries());

            if (adicionarCliente(dados)) {
                alert('Cliente cadastrado com sucesso!');
                fecharModal();
                atualizarEstatisticas();
                this.reset();
            } else {
                alert('Erro ao cadastrar cliente. Tente novamente.');
            }
        });

        // Evento de busca de cliente
        document.getElementById('buscaCliente').addEventListener('input', function(e) {
            const termo = e.target.value.trim();
            const resultados = buscarClientes(termo);
            const container = document.getElementById('resultadosBusca');
            
            container.innerHTML = '';
            
            if (resultados.length === 0) {
                container.innerHTML = '<p>Nenhum cliente encontrado.</p>';
                return;
            }
            
            resultados.forEach(cliente => {
                const div = document.createElement('div');
                div.className = 'resultado-cliente';
                div.innerHTML = `
                    <div class="cliente-info">
                        <div class="cliente-avatar">${cliente.nome.charAt(0).toUpperCase()}</div>
                        <div>
                            <strong>${cliente.nome}</strong>
                            <p>${cliente.telefone} | ${cliente.cpfCnpj}</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="selecionarCliente('${cliente.id}')">Selecionar</button>
                `;
                container.appendChild(div);
            });
        });

        // Formata√ß√£o autom√°tica de campos
        document.getElementById('cpfCnpjCliente').addEventListener('input', function(e) {
            e.target.value = formatarCpfCnpj(e.target.value);
        });

        document.getElementById('telefoneCliente').addEventListener('input', function(e) {
            e.target.value = formatarTelefone(e.target.value);
        });

        // Fechar modal ao clicar fora
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    fecharModal();
                }
            });
        });

        // Toggle sidebar (mobile e desktop)
        document.getElementById('menuToggle').addEventListener('click', function() {
            const sidebarEl = document.getElementById('sidebar');
            const isMobile = window.matchMedia('(max-width: 768px)').matches;

            if (isMobile) {
                // Usar o comportamento mobile j√° suportado pelo CSS
                sidebarEl.classList.toggle('active');
                return;
            }

            // Desktop: recolhe/expande alterando width via estilo inline (sem precisar mexer no CSS global)
            // Inicializa√ß√£o √∫nica de propriedades para transi√ß√£o suave
            if (!sidebarEl.dataset.desktopInit) {
                sidebarEl.style.overflow = 'hidden';
                sidebarEl.style.transition = 'width 0.25s ease';
                sidebarEl.dataset.desktopInit = 'true';
            }

            const isCollapsed = sidebarEl.style.width === '0px';
            if (isCollapsed) {
                // expandir
                sidebarEl.style.width = '230px';
                } else {
                // recolher
                // largura padr√£o da sidebar no CSS √© 230px; ao recolher, usamos 0
                sidebarEl.style.width = '0px';
            }
        });

        // Navega√ß√£o do menu
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', function(e) {
                document.querySelectorAll('.sidebar-menu a').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('active');
                }
                
                console.log('Navegando para:', this.getAttribute('href'));
            });
        });

        // ============================
        // INICIALIZA√á√ÉO
        // ============================

        document.addEventListener('DOMContentLoaded', function() {
            // Protege a p√°gina
            protegerPagina();
            
            // Atualiza informa√ß√µes do usu√°rio
            atualizarInfoUsuario();
            
            // Carrega dados
            carregarOS();
            carregarClientes();
            carregarProdutos();
            
            // Renderiza interface
            renderizarTabelaOS();
            renderizarAlertas();
            atualizarEstatisticas();
            
            console.log('‚úÖ P√°gina de atendimento carregada!');
        });
    </script>

    <style>
        /* Estilos espec√≠ficos para a p√°gina de atendimento */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.blue { background: #dbeafe; color: #1e3a8a; }
        .stat-icon.green { background: #d1fae5; color: #065f46; }
        .stat-icon.yellow { background: #fef3c7; color: #92400e; }
        .stat-icon.red { background: #fee2e2; color: #dc2626; }

        .stat-info h3 {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-blue);
            margin: 0;
        }

        .stat-info p {
            color: var(--gray-medium);
            margin: 5px 0 0 0;
            font-size: 14px;
        }

        .aparelho-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .aparelho-icon {
            width: 30px;
            height: 30px;
            background: var(--primary-blue);
                color: white;
                border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .problema-cell {
            max-width: 200px;
            word-wrap: break-word;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-badge.aguardando {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.em_reparo {
            background: #dbeafe;
            color: #1e3a8a;
        }

        .status-badge.pronto {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.entregue {
            background: #e5e7eb;
            color: #374151;
        }

        .status-badge.cancelado {
            background: #fee2e2;
            color: #dc2626;
        }

        .resultados-busca {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .resultado-cliente {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .cliente-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cliente-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .alert-item.critical {
            border-left-color: var(--red);
            background: #fee2e2;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .os-table {
                font-size: 12px;
            }
            
            .os-table th,
            .os-table td {
                padding: 8px;
            }
        }
    </style>
</body>

</html>